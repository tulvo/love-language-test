<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>사랑의 언어 테스트</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');

    body {
        font-family: 'Noto Sans KR', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #fcf4f6;
        color: #4a4a4a;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        box-sizing: border-box;
    }
    .container {
        width: 90%;
        max-width: 550px;
        padding: 40px 30px;
        background-color: #ffffff;
        border-radius: 16px;
        box-shadow: 0 8px 30px rgba(0,0,0,0.08);
        text-align: center;
        min-height: 550px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    h1 {
        font-size: 2em;
        margin-bottom: 8px;
        color: #4a4a4a;
    }
    #intro {
        font-size: 1.1em;
        color: #888;
        margin-bottom: 30px;
    }
    .progress-bar-container {
        width: 100%;
        height: 10px;
        background-color: #e0e0e0;
        border-radius: 5px;
        margin-bottom: 30px;
        overflow: hidden;
    }
    .progress-bar {
        height: 100%;
        width: 0;
        background-color: #ff99aa;
        border-radius: 5px;
        transition: width 0.3s ease-in-out;
    }
    .question-counter {
        font-size: 1.2em;
        color: #999;
        font-weight: normal;
        margin-bottom: 10px;
    }
    .buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    button {
        padding: 20px;
        font-size: 1.1em;
        cursor: pointer;
        border: 1px solid #ddd;
        border-radius: 10px;
        background-color: #fefefe;
        transition: all 0.3s ease;
        text-align: left;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        min-height: 100px;
        display: flex;
        align-items: center;
    }
    button:hover {
        background-color: #ffe6e9;
        border-color: #ff99aa;
        transform: translateY(-2px);
    }
    button:active {
        background-color: #ffc2d1;
        transform: scale(0.98);
    }
    #result {
        white-space: pre-line;
        font-size: 1.2em;
        margin-top: 40px;
        line-height: 1.6;
        text-align: left;
    }
    #result span {
        font-weight: bold;
        color: #555;
    }
</style>
</head>
<body>

<div class="container">
    <h1>사랑의 언어 테스트</h1>
    <div id="intro">더 선호하는 것을 고르세요</div>
    <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
    <div class="question-counter" id="questionCounter"></div>
    <div class="buttons">
        <button id="btnA" onclick="selectAnswer(questions[current].a)"></button>
        <button id="btnB" onclick="selectAnswer(questions[current].b)"></button>
    </div>
    <div id="result"></div>
</div>

<script>
    const questions = [
        { q: "나는 상대로부터 인정받는 말 듣는 것을 좋아한다.", a: "A", q_b: "나는 상대와 단둘이 보내는 시간을 좋아한다.", b: "B" },
        { q: "나는 상대에게 선물 받는 것을 좋아한다.", a: "C", q_b: "나는 상대가 나를 도와줄 때 사랑을 느낀다.", b: "D" },
        { q: "나는 상대가 감싸 안아 줄 때 사랑을 느낀다.", a: "E", q_b: "나는 상대와 함께 외출하는 것을 좋아한다.", b: "B" },
        { q: "나는 상대가 나를 인정해 줄 때 사랑을 느낀다.", a: "A", q_b: "나에게는 눈에 보이는 선물이 매우 의미가 있다.", b: "C" },
        { q: "나는 상대와 함께 붙어 앉는 것을 좋아한다.", a: "E", q_b: "나는 상대와 함께 시간 보내는 것을 좋아한다.", b: "B" },
        { q: "나는 상대가 나를 도와줄 때 사랑을 느낀다.", a: "D", q_b: "나를 이해해주는 말들이 나에게는 중요하다.", b: "A" },
        { q: "나는 상대와 뭔가 함께 하는 것을 좋아한다.", a: "B", q_b: "나는 상대가 해주는 친절한 말들을 좋아한다.", b: "A" },
        { q: "나는 상대와 포옹할 때 완전함을 느낀다.", a: "E", q_b: "나는 상대의 말보다 행동을 볼 때 더 감동한다.", b: "D" },
        { q: "나는 상대의 칭찬을 좋아하고 비판을 회피하는 편이다.", a: "A", q_b: "나는 커다란 선물보다는 작지만 자주 받는 것을 좋아한다.", b: "C" },
        { q: "나는 상대가 자주 신체접촉해 줄 때 더 친근함을 느낀다.", a: "E", q_b: "나는 상대와 함께 뭔가 하거나 이야기할 때 친밀함을 느낀다.", b: "B" },
        { q: "나는 상대가 내가 해 낸 일에 대해 칭찬하는 것을 좋아한다.", a: "A", q_b: "나는 상대가 나를 위해 기꺼이 하기 싫은 일을 해 줄때 진정한 사랑을 느낀다.", b: "D" },
        { q: "나는 상대와 걸을 때 손잡아 주는 것을 좋아한다.", a: "E", q_b: "나는 상대가 내 이야기에 공감하면서 들어주는 것을 좋아한다.", b: "A" },
        { q: "나는 상대에게 선물받는 것을 정말 즐거워한다.", a: "C", q_b: "나는 상대가 집안일을 도와줄 때 사랑을 느낀다.", b: "D" },
        { q: "나는 상대방이 내 외모에 대해 칭찬해주는 것을 좋아한다.", a: "A", q_b: "나는 상대가 내 기분을 이해하기 위해 시간을 내 줄때 사랑을 느낀다.", b: "B" },
        { q: "나는 상대가 나를 어루만져 줄 때 평안함을 느낀다.", a: "E", q_b: "나는 상대의 수고에 사랑을 느낀다.", b: "D" },
        { q: "나는 나를 위해 수고하는 상대에게 고마움을 느낀다.", a: "D", q_b: "나는 상대가 만든 선물을 받는 것을 좋아한다.", b: "C" },
        { q: "나는 상대가 나에게 전념할 때 그 느낌을 굉장히 좋아한다.", a: "B", q_b: "나는 상대가 나를 위해 실제로 행할 때 그 느낌을 굉장히 좋아한다.", b: "D" },
        { q: "나는 상대가 선물과 함께 내 생일을 축하해 줄 때 사랑을 느낀다.", a: "C", q_b: "나는 상대가 장문의 손편지와 함께 내 생일을 축하해 줄 때 사랑을 느낀다.", b: "A" },
        { q: "나는 상대가 집안일을 도와줄 때 사랑을 느낀다.", a: "D", q_b: "나는 상대가 선물을 줄 때 나를 사랑해주는 것이라고 느낀다.", b: "C" },
        { q: "나는 상대가 선물과 함께 특정한 날을 기억해 줄 때 고마움을 느낀다.", a: "C", q_b: "나는 상대가 끝까지 인내를 가지고 이야기를 들어줄 때 고마움을 느낀다.", b: "B" },
        { q: "나는 상대와 장기간 여행을 즐기기 원한다.", a: "B", q_b: "나는 상대가 내가 하는 일상적인 일에 충분히 관심을 기울여 주기를 바란다.", b: "A" },
        { q: "기대하지 않은 스킨십십이 나를 설레게 한다.", a: "E", q_b: "특별하지 않은 때라도 받는 선물은 나를 설레게 한다.", b: "C" },
        { q: "나는 상대에게 고맙다는 말을 듣는 것을 좋아한다.", a: "A", q_b: "나는 상대가 이야기 하는 동안 나를 바라보는 것을 좋아한다.", b: "B" },
        { q: "나는 상대와 손잡는 것을 좋아한다.", a: "E", q_b: "나는 상대와 함께 산책하는 시간을 좋아한다.", b: "B" },
        { q: "나는 상대가 얼마나 나에게 고마워하고 있는지 말해 줄 때 사랑을 느낀다.", a: "A", q_b: "나는 상대가 내가 부탁한 일에 최선을 다해 줄 때 사랑을 느낀다.", b: "D" },
        { q: "나는 매일 가벼운 신체 접촉을 원한다.", a: "E", q_b: "나는 매일 상대방의 지지하는 말이 필요하다.", b: "A" },
        { q: "나는 상대에게 선물 받는 것을 좋아한다.", a: "C", q_b: "나는 상대에게 가벼운 신체 접촉을 받을 때 사랑을 느낀다.", b: "E" },
        { q: "나는 상대가 나를 도와줄 때 사랑을 느낀다.", a: "D", q_b: "나는 상대가 안아주는 것을 좋아한다.", b: "E" },
        { q: "나는 상대와 단둘이 보내는 시간을 좋아한다.", a: "B", q_b: "나는 상대에게 작지만 선물받는 것을 좋아한다.", b: "C" },
        { q: "나는 상대에게 칭찬을 받을 때 사랑을 느낀다.", a: "A", q_b: "나는 상대가 나를 위해 기꺼이 하기 싫은 일을 해줄 때 사랑을 느낀다.", b: "D" }
    ];

    let current = 0;
    let scores = {A:0, B:0, C:0, D:0, E:0};

    function updateProgressBar() {
        const progressBar = document.getElementById('progressBar');
        const progress = (current / questions.length) * 100;
        progressBar.style.width = `${progress}%`;
    }

    function loadQuestion() {
        if (current < questions.length) {
            document.getElementById('questionCounter').innerText = `(${current + 1}/${questions.length})`;
            document.getElementById('btnA').innerText = questions[current].q;
            document.getElementById('btnB').innerText = questions[current].q_b;
            updateProgressBar();
        } else {
            showResult();
        }
    }

    function selectAnswer(choice) {
        scores[choice]++;
        current++;
        loadQuestion();
    }

    function showResult() {
        const map = {
            A: "인정하는 말",
            B: "함께하는 시간",
            C: "선물",
            D: "봉사",
            E: "스킨십"
        };
        const descriptions = {
            A: "칭찬, 격려, 인정하는 말로 사랑을 느낍니다. 진심 어린 칭찬과 지지하는 말은 당신에게 가장 큰 의미를 지니며, 비난이나 부정적인 말은 큰 상처가 될 수 있습니다.",
            B: "상대방과 함께하는 특별한 시간에 사랑을 느낍니다. 이는 단순히 옆에 있는 것을 넘어, 서로에게 온전히 집중하는 의미 있는 시간을 뜻합니다.",
            C: "작더라도 마음이 담긴 선물을 주고받으며 사랑을 느낍니다. 선물은 당신에게 '나를 생각하고 있구나'라는 확신을 주는 중요한 증거입니다.",
            D: "상대가 나를 위해 해주는 행동과 봉사로 사랑을 느낍니다. 상대방이 나의 삶에 도움을 주거나, 나를 위해 기꺼이 수고하는 모습을 볼 때 깊은 사랑을 느낍니다.",
            E: "가벼운 스킨십이나 포옹을 통해 사랑을 느낍니다. 신체적인 접촉은 당신에게 안정감과 친밀감을 주며, 말로 표현하기 힘든 감정을 전달하는 강력한 수단입니다."
        };

        const resultDiv = document.getElementById('result');
        let sorted = Object.entries(scores).sort((a,b) => b[1]-a[1]);
        const maxScore = sorted[0][1];
        const minScore = sorted[sorted.length-1][1];
        const topLanguageKey = sorted[0][0];

        const topLanguages = sorted.filter(([_,score]) => score === maxScore).map(([letter]) => map[letter]);
        const allScores = Object.values(scores);
        const maxDiff = maxScore - minScore;
        
        let resultText = "## 당신의 사랑의 언어 결과는... ❤️\n\n";

        // AI 해설 추가
        if (topLanguages.length > 1 && maxDiff <= 2) {
            resultText += `**총평**: 당신은 모든 사랑의 언어에 고르게 반응하는 다정하고 개방적인 사람입니다. 특정 언어에 얽매이지 않고, 다양한 방식으로 사랑을 주고받는 것을 즐깁니다. 상대방의 어떤 표현이든 진심으로 받아들일 준비가 되어 있습니다.\n\n`;
            resultText += `<span>제1언어(복수)</span>: ${topLanguages.join(", ")}\n`;
        } else if (maxScore - sorted[1][1] >= 4) {
            resultText += `**총평**: 당신의 사랑의 언어는 ${map[topLanguageKey]}로 압도적으로 높게 나타났습니다. 이는 당신이 이 언어를 통해 사랑을 가장 강렬하게 느끼고, 상대방에게도 이 방식으로 사랑을 표현하는 것이 익숙하다는 것을 의미합니다. 상대방과 소통할 때 이 부분을 명확히 전달하는 것이 관계에 도움이 될 수 있습니다.\n\n`;
            resultText += `<span>제1언어</span>: ${map[topLanguageKey]}\n`;
            resultText += `**해설**: ${descriptions[topLanguageKey]}\n\n`;
        } else if (allScores.every(s => s <= 4)) {
            resultText += `**총평**: 당신은 아직 자신의 사랑의 언어를 탐색 중이거나, 매우 섬세한 사람일 수 있습니다. 점수가 고르게 낮게 나왔으므로, 다양한 사랑의 표현에 대해 더 깊이 생각해 보는 시간이 필요합니다. 상대방과의 소통을 통해 자신에게 어떤 방식이 가장 큰 행복을 주는지 찾아보세요.\n\n`;
            resultText += `<span>제1언어</span>: ${topLanguages.join(", ")}\n`;
        } else {
            resultText += `<span>제1언어</span>: ${map[topLanguageKey]}\n`;
            resultText += `**해설**: ${descriptions[topLanguageKey]}\n\n`;
        }

        resultText += "---<br><br>각 언어 점수:<br>";
        for (const [key, value] of sorted) {
            const starCount = '⭐️'.repeat(Math.floor(value / 3));
            resultText += `• ${map[key]}: ${value}점 ${starCount}\n`;
        }

        resultDiv.innerHTML = resultText.replace(/\n/g, '<br>');
        document.getElementById('intro').innerText = "결과가 나왔습니다!";
        document.getElementById('questionCounter').innerText = "";
        document.querySelector('.buttons').style.display = "none";
        document.querySelector('.progress-bar-container').style.display = "none";

        // Apps Script로 점수 전송
        const formData = new FormData();
        formData.append('scoreA', scores.A);
        formData.append('scoreB', scores.B);
        formData.append('scoreC', scores.C);
        formData.append('scoreD', scores.D);
        formData.append('scoreE', scores.E);

        fetch('https://script.google.com/macros/s/AKfycbyPeC07og10gzl3dkSejcy70kClGMS35yKklGlpsZ0A9mfLm33ECFMdElKlO40Gg6gq/exec', {
            method: 'POST',
            body: formData,
        })
        .then(response => response.text())
        .then(data => console.log('Apps Script 응답:', data))
        .catch(error => console.error('Error:', error));
    }

    loadQuestion();
</script>

</body>
</html>
